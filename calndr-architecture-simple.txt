CALNDR BACKEND ARCHITECTURE - STAGING & PRODUCTION

========================================
EXTERNAL SERVICES
========================================
Users
iOS App
Web App
GitHub Actions
Google Places API
Apple Auth (Sign-In, Push Notifications)
Google OAuth
Facebook OAuth
SMTP Service (AWS SES)

========================================
GLOBAL AWS SERVICES
========================================
Route 53 (DNS)
ACM (SSL Certificates)

========================================
PRODUCTION ENVIRONMENT (VPC: 10.0.0.0/16)
========================================

PUBLIC SUBNETS (10.0.1.0/24, 10.0.2.0/24)
- Application Load Balancer (Production)
- NAT Gateway 1
- NAT Gateway 2
- Target Group (Health Checks)

PRIVATE SUBNETS (10.0.3.0/24, 10.0.4.0/24)
- ECS Fargate Cluster (Production)
- ElastiCache Redis (Multi-AZ, Auth enabled)
- Auto Scaling (CPU/Memory based)

DATABASE SUBNETS (10.0.5.0/24, 10.0.6.0/24)
- RDS PostgreSQL Primary (Multi-AZ)
- RDS Read Replica

========================================
STAGING ENVIRONMENT (VPC: 10.1.0.0/16)
========================================

PUBLIC SUBNETS (10.1.1.0/24, 10.1.2.0/24)
- Application Load Balancer (Staging)
- NAT Gateway 1
- NAT Gateway 2
- Target Group (Health Checks)

PRIVATE SUBNETS (10.1.3.0/24, 10.1.4.0/24)
- ECS Fargate Cluster (Staging)
- ElastiCache Redis (Single node)
- Auto Scaling (Basic configuration)

DATABASE SUBNETS (10.1.5.0/24, 10.1.6.0/24)
- RDS PostgreSQL (Single AZ)

========================================
SHARED AWS SERVICES
========================================
ECR (Container Registry)
CloudWatch (Logs & Metrics)
SNS (Email Alerts)
SSM Parameter Store (Secrets)
IAM (Roles & Policies)
S3 (Storage & Terraform State)
DynamoDB (Terraform State Locking)

========================================
DATA FLOW CONNECTIONS
========================================

USER TRAFFIC:
Users/iOS/Web → Route 53 → Production ALB → Production ECS
Users/iOS/Web → Route 53 → Staging ALB → Staging ECS

SSL TERMINATION:
ACM → Production ALB
ACM → Staging ALB

PRODUCTION FLOW:
Production ALB → Target Group → Production ECS
Production ECS → RDS Primary (PostgreSQL:5432)
Production ECS → Redis (6379)
RDS Primary → Read Replica
Auto Scaling → Production ECS

STAGING FLOW:
Staging ALB → Target Group → Staging ECS
Staging ECS → RDS Staging (PostgreSQL:5432)
Staging ECS → Redis Staging (6379)
Auto Scaling → Staging ECS

CONTAINER DEPLOYMENT:
GitHub Actions → ECR
ECR → Production ECS
ECR → Staging ECS

EXTERNAL API CALLS:
Production ECS → Google Places API
Production ECS → Auth APIs (Apple, Google, Facebook)
Production ECS → SMTP Service
Staging ECS → Google Places API
Staging ECS → Auth APIs (Apple, Google, Facebook)
Staging ECS → SMTP Service

MONITORING:
Production ECS → CloudWatch
Staging ECS → CloudWatch
Production RDS → CloudWatch
Staging RDS → CloudWatch
CloudWatch → SNS (Alerts)

CONFIGURATION:
SSM → Production ECS (Secrets)
SSM → Staging ECS (Secrets)
IAM → Production ECS (Permissions)
IAM → Staging ECS (Permissions)
S3 → Production ECS (Assets)
S3 → Staging ECS (Assets)

========================================
SECURITY GROUPS
========================================

ALB Security Group:
- Inbound: HTTP (80), HTTPS (443) from 0.0.0.0/0
- Outbound: All traffic

ECS Tasks Security Group:
- Inbound: Port 8000 from ALB Security Group
- Outbound: All traffic

RDS Security Group:
- Inbound: PostgreSQL (5432) from ECS Tasks Security Group
- Outbound: All traffic

Redis Security Group:
- Inbound: Redis (6379) from ECS Tasks Security Group
- Outbound: All traffic

========================================
KEY DIFFERENCES: PRODUCTION vs STAGING
========================================

PRODUCTION:
- Multi-AZ RDS with read replica
- Redis with authentication
- Enhanced monitoring and alerting
- Deletion protection enabled
- Email alerts configured
- Higher resource allocation

STAGING:
- Single AZ RDS (cost optimization)
- Redis without authentication
- Basic monitoring
- No deletion protection
- Reduced resource allocation
- Cost-optimized configuration

========================================
PORTS AND PROTOCOLS
========================================

External Access:
- HTTP: 80 (redirects to HTTPS)
- HTTPS: 443

Internal Communication:
- ECS Container: 8000
- PostgreSQL: 5432
- Redis: 6379
- SMTP: 25 (AWS SES)

========================================
DOMAINS
========================================

Production: api.calndr.club
Staging: staging-api.calndr.club 